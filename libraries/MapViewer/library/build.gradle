buildscript {
	repositories {
		mavenCentral()
	}

	dependencies {
		classpath 'com.github.dcendents:android-maven-plugin:1.0'
	}
}

apply plugin: 'android-library'
apply plugin: 'android-maven'

dependencies {
	compile 'com.google.android.gms:play-services:4.2.42'
	compile 'com.google.maps.android:android-maps-utils:0.3'
}

android {
	compileSdkVersion 19
	buildToolsVersion "19.0.3"

	sourceSets {
		main {
			manifest.srcFile 'AndroidManifest.xml'
			java.srcDirs = ['src']
			resources.srcDirs = ['src']
			aidl.srcDirs = ['src']
			renderscript.srcDirs = ['src']
			res.srcDirs = ['res']
			assets.srcDirs = ['assets']
		}
	}

	libraryVariants.all { variant ->
		// This is an annoying hack to get around the fact that the Gradle plugin does not support
		// having libraries with different minSdkVersions. Play Services has a min version of 9 (Gingerbread)
		// but Android Maps Utils supports 8 (Froyo) still
		variant.processManifest.doFirst {
			File manifestFile = file("${buildDir}/exploded-aar/com.google.maps.android/android-maps-utils/0.3/AndroidManifest.xml")
			if (manifestFile.exists()) {
				println("Replacing minSdkVersion in Android Maps Utils")
				String content = manifestFile.getText('UTF-8')
				content = content.replaceAll(/minSdkVersion="8"/, 'minSdkVersion=\"9\"')
				manifestFile.write(content, 'UTF-8')
				println(content)
			}
		}
	}
}

task instrumentTest(dependsOn: connectedCheck)

apply from: '../../../distribution/maven_push.gradle'
